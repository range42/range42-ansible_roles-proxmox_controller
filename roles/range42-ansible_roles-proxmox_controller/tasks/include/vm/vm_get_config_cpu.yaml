---
##
##
##

- block:
    ####
    ####

    - name: VM - GET CONFIG CPU
      vars:
        proxmox_vmid: 100 # TODO - OVERWRITED_ARGUMENTS

      uri:
        url: "https://{{ proxmox_api_host }}/api2/json/nodes/{{ proxmox_node }}/qemu/{{ vm_id }}/config"
        method: GET
        headers:
          Authorization: "PVEAPIToken={{ proxmox_api_user }}!{{ proxmox_api_token_id }}={{ proxmox_api_token_secret }}"
        validate_certs: no
      register: proxmox_call

    ####
    ####

    - name: VM - GET CONFIG - PRINT proxmox_call
      debug:
        var: proxmox_call

    - name: VM - GET CONFIG CPU - BUILD JSON
      set_fact:
        vm_get_config_cpu: >-
          {{ {
              'action' : "vm_get_config_ram", 
              'source' : "proxmox", 
              'proxmox_node': proxmox_node,

              'vm_id'  : vm_id,
              'vm_arch'   : "{{ proxmox_call.json.data.cpu     | default(0) }}",
              'vm_cores'  : "{{ proxmox_call.json.data.cores   | default(0) }}",
              'vm_sockets': "{{ proxmox_call.json.data.sockets | default(0) }}",
            }
            | to_json
          }}

    - name: VM - GET CONFIG CPU - PRINT JSON
      debug:
        var: vm_get_config_cpu

  ####
  ####

  when: proxmox_vm_action == "vm_get_config_cpu"
